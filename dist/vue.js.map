{"version":3,"file":"vue.js","sources":["../src/utils/utils.js","../src/observer/array.js","../src/observer/index.js","../src/instance/state.js","../src/instance/init.js","../src/instance/index.js"],"sourcesContent":["export function isFunction (value) {\r\n  return typeof value === 'function'\r\n}\r\n\r\nexport function isObject (value) {\r\n  return typeof value === 'object' && value !== null\r\n}\r\n\r\nexport const isArray = Array.isArray\r\n\r\nexport function hasOwn (obj, prop) {\r\n  return Object.prototype.hasOwnProperty.call(obj, prop)\r\n}\r\n\r\nexport function def (obj, key, value) {\r\n  Object.defineProperty(obj, key, {\r\n    configurable: true,\r\n    enumerable: false,\r\n    writable: true,\r\n    value\r\n  })\r\n}\r\n","import { def } from '../utils'\r\n\r\nconst arrayProto = Array.prototype\r\nexport const arrayMethods = Object.create(arrayProto)\r\n\r\nconst patchToMethods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'reverse',\r\n  'sort'\r\n]\r\n\r\npatchToMethods.forEach(method => {\r\n  const original = arrayProto[method] // 获取Array.prototype上的元素方法 AOP\r\n  def(arrayMethods, method, function mutator (...args) { // 为arrayMethods重新定义变异方法\r\n    const result = original.apply(this, ...args)\r\n    const ob = this.__ob__\r\n    let inserted\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n\r\n    // 当method为push、unshit、splice时，它们可能会新增数据，也需要监测插入项\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n    return result\r\n  })\r\n})","import { isObject, hasOwn, def, isArray } from '../utils'\r\nimport { arrayMethods } from './array'\r\n\r\nclass Observer {\r\n  constructor (value) {\r\n    this.value = value\r\n    def(value, '__ob__', this) // 把Observer实例通过__ob__属性（不可枚举 ，否则会导致循环引用问题）挂载到被观测的对象value上\r\n\r\n    // 数组和对象要分开观测\r\n    if (isArray(value)) {\r\n      const agument = hasProto ? protoAgument : copyAgument\r\n      agument(value, arrayMethods, arrayKeys)\r\n      this.observeArray(value) // 要监测数组的每一项\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  observeArray (array) {\r\n    for (let i = 0; i < array.length; i++) {\r\n      observe(array[i])\r\n    }\r\n  }\r\n\r\n  walk (obj) {\r\n    const keys = Object.keys(obj)\r\n    for (let i = 0; i < keys.length; i++) {\r\n      const key = keys[i]\r\n      defineReactive(obj, key, obj[key])\r\n    }\r\n  }\r\n}\r\n\r\nconst hasProto = '__proto__' in {}\r\nconst arrayKeys = Object.getOwnPropertyNames(arrayMethods) // 变异方法列表\r\n\r\n// 将目标对象的__proto__指向源对象\r\n// 如果存在__proto__，那么就将数组的__proto__指向arrayMethods，此时当调用变异方法时，会直接去其原型对象arrayMethods上去找，此时变异方法都通过AOP重写，当调用非变异方法时，会通过原型链直接取到Array.prototype上的原型方法（因为arrayMethods继承自Array.prototype）\r\nfunction protoAgument (target, src) {\r\n  target.__proto__ = src\r\n}\r\n\r\n// 如果不存在__proto__，那么直接将变异方法直接定义到实例上\r\nfunction copyAgument (target, src, keys) {\r\n  console.log(target, src, keys)\r\n  for (let i = 0; i < keys.length; i++) {\r\n    def(target, keys[i], src[keys[i]])\r\n  }\r\n}\r\n\r\nexport function defineReactive (obj, key, value) {\r\n  observe(value)\r\n  Object.defineProperty(obj, key, {\r\n    configurable: true,\r\n    enumerable: true, \r\n    get () {\r\n      return value\r\n    },\r\n    set (newVal) {\r\n      if (value === newVal) return\r\n      observe(newVal)\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe (data) {\r\n  if (!isObject(data)) return // 只接受对象类型\r\n  let ob\r\n  if (hasOwn(data, '__ob__') && data.__ob__ instanceof Observer) {\r\n    // 如果data有__ob__属性，并且data的__ob__属性是Observer的实例，表明已经观测过了，避免重复观测\r\n    ob = data.__ob__\r\n  } else {\r\n    // 对未被观测的data进行观测\r\n    ob = new Observer(data)\r\n  }\r\n  return ob\r\n}\r\n","import { isFunction } from '../utils'\r\nimport { observe } from '../observer'\r\n\r\nexport function initState (vm) {\r\n  const opts = vm.$options\r\n  if (opts.data) {\r\n    initData(vm, opts.data)\r\n  }\r\n}\r\n\r\n// 代理\r\n// 当用户直接通过vm[prop]会将用户代理到vm._data[prop]上，取值、存值都进行代理。\r\nfunction proxyData (target, source, key) {\r\n  Object.defineProperty(target, key, {\r\n    configurable: true,\r\n    enumerable: true,\r\n    get () {\r\n      return target[source][key]\r\n    },\r\n    set (newVal) {\r\n      target[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n\r\n// 初始化data\r\nfunction initData (vm, data) {\r\n  // Vue中data类型只能是函数和对象，只有根组件是对象，其他都是返回函数的对象\r\n  // 当一个组件被定义，data必须声明为返回一个初始数据对象的函数，因为组件可能被用来创建多个实例。如果data仍然是一个纯粹的对象，则所有实例将共享引用同一个数据对象！通过提供data函数，每次创建一个新实例后，我们能够调用data函数，从而返回一个全新副本数据对象。\r\n  data = vm.$data  = isFunction(data) ? data.call(vm) : data // 将data添加到Vue实例_data属性上\r\n\r\n  // 观测数据的变化\r\n  observe(data)\r\n\r\n  // 把data里面的属性都代理到vm上\r\n  const keys = Object.keys(data)\r\n  for (let i = 0; i < keys.length; i++) {\r\n    proxyData(vm, '$data', keys[i])\r\n  }\r\n}\r\n","import { initState } from './state'\r\n\r\nexport function initMixin (Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    vm.$options = options\r\n    initState(vm) // 初始化状态\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\nfunction Vue (options) {\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue) // 逻辑分离，为Vue添加实例方法_init\r\n\r\nexport default Vue\r\n"],"names":["isFunction","value","isObject","isArray","Array","hasOwn","obj","prop","Object","prototype","hasOwnProperty","call","def","key","defineProperty","configurable","enumerable","writable","arrayProto","arrayMethods","create","patchToMethods","forEach","method","original","mutator","args","result","apply","ob","__ob__","inserted","slice","observeArray","Observer","agument","hasProto","protoAgument","copyAgument","arrayKeys","walk","array","i","length","observe","keys","defineReactive","getOwnPropertyNames","target","src","__proto__","console","log","get","set","newVal","data","initState","vm","opts","$options","initData","proxyData","source","$data","initMixin","Vue","_init","options"],"mappings":"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"}